---
title: ダイナセット
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets, dynasets
- ODBC cursor library [ODBC], dynasets
- keyset-driven cursors in dynasets
- cursors [ODBC], keyset-driven cursors in dynasets
- cursor library [ODBC], dynaset availability
- recordsets [C++], dynasets
- dynasets
ms.assetid: 2867e6be-208e-4fe7-8bbe-b8697cb1045c
ms.openlocfilehash: ed7098600126005978c8b017e7db378fca4c1a68
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/24/2020
ms.locfileid: "80213240"
---
# <a name="dynaset"></a>ダイナセット

このトピックでは、ダイナセットについて説明し、その[可用性](#_core_availability_of_dynasets)について説明します。

> [!NOTE]
>  このトピックは、MFC ODBC クラス ( [CRecordset](../../mfc/reference/crecordset-class.md)を含む) に適用されます。 DAO クラスのダイナセットの詳細については、「 [CDaoRecordset](../../mfc/reference/cdaorecordset-class.md)」を参照してください。 DAO では、ダイナセット型のレコードセットを開くことができます。

ダイナセットは、動的プロパティを持つレコードセットです。 有効期間中、ダイナセットモードのレコードセットオブジェクト (通常はダイナセットと呼ばれます) は、次のようにデータソースと同期されたままになります。 マルチユーザー環境では、他のユーザーが、ダイナセットに含まれるレコードを編集または削除したり、ダイナセットが表すテーブルにレコードを追加したりすることができます。 レコードセットに対するアプリケーションの追加または削除が、ダイナセットに反映されます。 他のユーザーがテーブルに追加したレコードは、その `Requery` メンバー関数を呼び出すことによって、ダイナセットを再構築するまで、ダイナセットには反映されません。 他のユーザーがレコードを削除すると、MFC コードによってレコードセット内の削除がスキップされます。 既存のレコードに対する他のユーザーの編集変更は、影響を受けるレコードまでスクロールするとすぐに、ダイナセットに反映されます。

同様に、ダイナセット内のレコードに対して行った編集は、他のユーザーが使用しているダイナセットに反映されます。 追加したレコードは、ダイナセットを再クエリするまで、他のユーザーのダイナセットには反映されません。 削除したレコードは、他のユーザーのレコードセットでは "削除済み" としてマークされます。 同じデータベース (複数 `CDatabase` オブジェクト) に対して複数の接続が存在する場合、それらの接続に関連付けられているレコードセットは、他のユーザーのレコードセットと同じ状態になります。

ダイナセットは、航空会社の予約システムなど、データを動的にする必要がある場合に最も役立ちます。

> [!NOTE]
> ダイナセットを使用するには、ダイナセットをサポートするデータソース用の ODBC ドライバーが必要です。また、ODBC カーソルライブラリを読み込むことはできません。 詳細については、「[ダイナセットの可用性](#_core_availability_of_dynasets)」を参照してください。

レコードセットがダイナセットであることを指定するには、レコードセットオブジェクトの `Open` メンバー関数の最初のパラメーターとして `CRecordset::dynaset` を渡します。

> [!NOTE]
> 更新可能なダイナセットの場合、ODBC ドライバーは、配置された update ステートメントまたは `::SQLSetPos` ODBC API 関数をサポートしている必要があります。 両方がサポートされている場合、MFC では効率を上げるために `::SQLSetPos` を使用します。

##  <a name="availability-of-dynasets"></a><a name="_core_availability_of_dynasets"></a>ダイナセットの可用性

MFC データベースクラスでは、次の要件を満たしている場合、ダイナセットがサポートされます。

- ODBC カーソルライブラリ DLL は、このデータソースに使用されていない必要があります。

   カーソルライブラリを使用すると、ダイナセットのサポートに必要な、基になる ODBC ドライバーの一部の機能がマスクされます。 ダイナセットを使用する場合 (このセクションの残りの部分で説明するように、ODBC ドライバーがダイナセットに必要な機能を備えている場合)、`CDatabase` オブジェクトを作成するときに、MFC によってカーソルライブラリが読み込まれないようにすることができます。 詳細につい[ては、](../../mfc/reference/cdatabase-class.md#openex) 「 [ODBC](../../data/odbc/odbc-basics.md) 」および「`CDatabase`クラスのメンバー関数を[開く](../../mfc/reference/cdatabase-class.md#open)」を参照してください。

   ODBC の用語では、ダイナセットとスナップショットはカーソルと呼ばれます。 カーソルは、レコードセット内のその位置を追跡するために使用されるメカニズムです。

- データソースの ODBC ドライバーでキーセットドリブンカーソルがサポートされている必要があります。

   キーセットドリブンカーソルは、キーのセットを取得して格納することによって、テーブルのデータを管理します。 キーは、ユーザーが特定のレコードにスクロールしたときにテーブルから現在のデータを取得するために使用されます。 ドライバーがこのサポートを提供しているかどうかを判断するには、 *SQL_SCROLL_OPTIONS*パラメーターを使用して `::SQLGetInfo` ODBC API 関数を呼び出します。

   キーセットをサポートしていないダイナセットを開こうとすると、リターンコード値 AFX_SQL_ERROR_DYNASET_NOT_SUPPORTED を含む `CDBException` が取得されます。

- データソースの ODBC ドライバーでは、拡張フェッチがサポートされている必要があります。

   拡張フェッチとは、SQL クエリの結果として得られるレコードを前後にスクロールする機能です。 ドライバーがこの機能をサポートしているかどうかを判断するには、 *SQL_API_SQLEXTENDEDFETCH*パラメーターを使用して `::SQLGetFunctions` ODBC API 関数を呼び出します。

更新可能なダイナセット (またはスナップショット) を必要とする場合、ODBC ドライバーは `::SQLSetPos` ODBC API 関数または位置指定更新のいずれかもサポートする必要があります。 `::SQLSetPos` 関数を使用すると、SQL ステートメントを送信せずにデータソースを更新できます。 このサポートが利用可能な場合、MFC では、SQL を使用して更新を行うために、このサポートを優先的に使用します。 ドライバーが `::SQLSetPos`をサポートしているかどうかを判断するには、 *SQL_POS_OPERATIONS*パラメーターを指定して `::SQLGetInfo` を呼び出します。

位置指定更新では、データソース上のテーブル内の特定の行を識別するために、SQL 構文 (\<カーソル名 >**の現在の**形式) を使用します。 ドライバーが位置指定更新をサポートしているかどうかを判断するには、 *SQL_POSITIONED_STATEMENTS*パラメーターを指定して `::SQLGetInfo` を呼び出します。

一般に、MFC のダイナセット (前方参照専用レコードセットではありません) には、レベル2の API 準拠の ODBC ドライバーが必要です。 データソースのドライバーがレベル1の API セットに準拠している場合でも、更新可能なスナップショットと読み取り専用のスナップショットと順方向専用のレコードの両方を使用できますが、ダイナセットは使用できません。 ただし、拡張フェッチとキーセットドリブンカーソルがサポートされている場合は、レベル1のドライバーでダイナセットがサポートされることがあります。 ODBC 準拠レベルの詳細については、「 [odbc](../../data/odbc/odbc-basics.md)」を参照してください。

> [!NOTE]
> スナップショットとダイナセットの両方を使用する場合は、2つの異なる `CDatabase` オブジェクト (2 つの異なる接続) に基づいて作成する必要があります。

ODBC カーソルライブラリによって保持されている中間ストレージを使用するスナップショットとは異なり、ダイナセットは、スクロールするとすぐにデータソースから直接レコードをフェッチします。 これにより、ダイナセットによって最初に選択されたレコードがデータソースと同期されます。

Visual C++ のこのバージョンに含まれている ODBC ドライバー一覧、および他のドライバーを取得する方法については、「[ODBC ドライバーの一覧](../../data/odbc/odbc-driver-list.md)」を参照してください。

## <a name="see-also"></a>参照

[ODBC (Open Database Connectivity)](../../data/odbc/open-database-connectivity-odbc.md)
